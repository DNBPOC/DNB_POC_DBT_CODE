version: 2

sources:
  - name: Fit4_Calc_Data
    description: A replica of the postgres database loaded in  FM_DATA_TEST_DB.DBT_PVEENA.Fit4_Calc_Data
    schema: DBT_PVEENA
    database: VEENA_TEST_DB
    tables:
      - name: Fit4_Calc_Data
        freshness: # Check 
          warn_after: {count: 1, period: hour}
          error_after: {count: 12, period: hour}
          # Apply a where clause in the freshness query
          filter: datediff('day', _etl_loaded_at, current_timestamp) < 2


        columns:
          - name: KUNDENUMMER
            description: Customer number from Mainframe
            tests:
              - unique
              - not_null


          - name: KONTONUMMER
            description: AccouNT Number from Mainframe

          - name: KILDESYSTEM
            description: Foreign key to customers
            tests:
              - accepted_values:
                  values: ['placed', 'shipped', 'completed', 'return_pending', 'returned']


models:
  - name: stg_Fit4_Calc_Data
    config:
      tags: ['pii']
    columns:
      - name: KUNDENUMMER
        tests:
          - unique
          - not_null



